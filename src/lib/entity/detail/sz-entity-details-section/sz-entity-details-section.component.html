<sz-entity-detail-section-header
  [sectionTitle]="sectionTitle"
  [sectionCount]="sectionCount"
  [sectionIcon]="sectionIcon"
  [sectionId]="sectionId"
  [layoutClasses]="_layoutClasses"
  [ngClass]="_layoutClasses">
</sz-entity-detail-section-header>
<div [ngClass]="_layoutClasses">
  <ng-container *ngIf="showByDataSource">
    <sz-entity-detail-section-collapsible-card
      class="by-datasource"
      *ngFor="let dataSourceRecords of _sectionDataByDataSource; let ind = index"
      [showIcon]="showIcon"
      [headerIcon]="headerIcon"
      displayType="record"
      [showWhyUtilities]="showWhyUtilities && ind === 0"
      (onCompareRecordsForWhy)="_onCompareRecordsForWhy($event)"
      [cardData]="dataSourceRecords"
      [collapsedStatePrefsKey]="this.collapsedStatePrefsKey"
      [columnsShown]="this.sectionsShownColumns"
      [layoutClasses]="_layoutClasses"
      (onCollapsedChange)="this.onCollapsibleCardStateChange($event)"
      [truncateResults]="true"
      [dataSourceRecordsSelected]="selectedDataSourceRecords"
      (dataSourceRecordClicked)="onDataSourceRecordClick($event)"
      (dataSourceRecordWhyClicked)="onDataSourceRecordWhyClick($event)"
      [recordWhyMultiselectActive]="dataSourceIsSelectable"
      [whySelectionMode]="whySelectionMode"
      (dataSourceSelectModeChanged)="onDataSourceSelectModeChanged($event)"
      (entityRecordClick)="onEntityRecordClick($event)">
    </sz-entity-detail-section-collapsible-card>
  </ng-container>
  <ng-container *ngIf="showEntitiesByMatchKey">
    <sz-entity-detail-section-collapsible-card
      class="by-matchkey"
      *ngFor="let entitiesByMatchKey of _sectionDataByMatchKey"
      [showIcon]="showIcon"
      [headerIcon]="headerIcon"
      displayType="entity"
      [cardData]="entitiesByMatchKey"
      [truncateResults]="true"
      [collapsedStatePrefsKey]="this.collapsedStatePrefsKey"
      [layoutClasses]="_layoutClasses"
      [showOtherDataInEntities]="showOtherDataInEntities"
      [showBestNameOnlyinEntities]="showBestNameOnlyInEntities"
      [showNameDataInEntities]="showNameDataInEntities"
      [whySelectionMode]="whySelectionMode"
      (onCollapsedChange)="this.onCollapsibleCardStateChange($event)"
      (onCompareEntitiesForWhyNot)="_onCompareEntitiesForWhyNot($event)"
      (entityRecordClick)="onEntityRecordClick($event)"
      (entityRecordWhyNotClick)="onEntityRecordWhyNotClick($event)"
      class="by-match-key">
    </sz-entity-detail-section-collapsible-card>
  </ng-container>
  <ng-container *ngIf="!showByDataSource && !showEntitiesByMatchKey">
    <sz-entity-detail-section-collapsible-card
      class="by-entity"
      *ngFor="let cardData of sectionData"
      [showIcon]="showIcon"
      [headerIcon]="headerIcon"
      displayType="entity"
      [cardData]="cardData"
      [collapsedStatePrefsKey]="this.collapsedStatePrefsKey"
      [layoutClasses]="_layoutClasses"
      (onCollapsedChange)="this.onCollapsibleCardStateChange($event)"
      (onCompareEntitiesForWhyNot)="_onCompareEntitiesForWhyNot($event)"
      [truncateResults]="true"
      [showBestNameOnlyinEntities]="showBestNameOnlyInEntities"
      [showNameDataInEntities]="showNameDataInEntities"
      [whySelectionMode]="whySelectionMode"
      (entityRecordClick)="onEntityRecordClick($event)"
      (entityRecordWhyNotClick)="onEntityRecordWhyNotClick($event)">
    </sz-entity-detail-section-collapsible-card>
  </ng-container>
</div>

