<sz-how-rc-nav
    [stepsByVirtualId]="resolutionStepsByVirtualId"
    [finalVirtualEntities]="finalCardsData"
    [virtualEntitiesById]="virtualEntitiesById"
    [finalEntityId]="entityId"
    *ngIf="showNavigation"
></sz-how-rc-nav>
<div class="main">
    <button (click)="getDefaultResolutionStepGroups()">get default step groups list</button>

    <ul class="step-list tree">
        <li class="top-level">
            <sz-how-rc-final-entity-card *ngFor="let vCardData of finalCardsData"
                [data]="vCardData"
                [featureOrder]="orderedFeatures"
                [virtualEntitiesById]="virtualEntitiesById"></sz-how-rc-final-entity-card>
        </li>
        <li *ngFor="let step of resolutionStepsWithGroups; let rsInd=index"
            [ngSwitch]="isResolutionStep(step)">
            <ng-template [ngSwitchCase]="false">
                <sz-how-rc-step-group
                    [data]="cooerceToStepGroup(step)"
                    [featureOrder]="orderedFeatures" 
                    [virtualEntitiesById]="virtualEntitiesById"></sz-how-rc-step-group>
            </ng-template>
            <ng-template [ngSwitchCase]="true">
                <sz-how-rc-step *ngIf="isResolutionStep(step)"
                [attr.step-index]="rsInd"
                [attr.step-number]="cooerceToStep(step).stepNumber"
                [attr.virtual-id]="cooerceToStep(step).resolvedVirtualEntityId"
                [data]="cooerceToStep(step)" 
                [featureOrder]="orderedFeatures" 
                [virtualEntitiesById]="virtualEntitiesById"></sz-how-rc-step>
            </ng-template>
            <ng-template [ngSwitchCase]="false">
                <div class="stack-control" 
                    [class.expanded]="isGroupExpanded(cooerceToStepGroup(step))"
                    (click)="toggleCollapsedState(cooerceToStepGroup(step))">
                    <!-- start collapsed  icon set -->
                    <mat-icon 
                    aria-hidden="false" 
                    class="hide-on-expanded"
                    fontIcon="arrow_upward"></mat-icon>
                    <div class="center-area hide-on-expanded">
                        <mat-icon 
                        aria-hidden="false" 
                        class="center-button"
                        fontIcon="add_circle"></mat-icon>
                    </div>
                    <mat-icon 
                    aria-hidden="false" 
                    class="hide-on-expanded"
                    fontIcon="arrow_downward"></mat-icon>
                    <!-- end   collapsed icon set -->
                    <!-- start expanded icon set  -->
                    <mat-icon 
                    aria-hidden="false" 
                    class="hide-on-collapsed arrow-down"
                    fontIcon="arrow_right"></mat-icon>
                    <div class="center-area hide-on-collapsed">
                        <mat-icon 
                        aria-hidden="false" 
                        class="center-button minus-button"
                        fontIcon="circle"><span>-</span></mat-icon>
                    </div>
                    <mat-icon 
                    aria-hidden="false" 
                    class="hide-on-collapsed arrow-up"
                    fontIcon="arrow_right"></mat-icon>
                    <!-- end   expanded icon set  -->
                </div>
            </ng-template>
        </li>
    </ul>
</div>