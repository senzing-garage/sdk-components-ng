<sz-how-rc-nav
    [stepsByVirtualId]="resolutionStepsByVirtualId"
    [virtualEntitiesById]="virtualEntitiesById"
    *ngIf="showNavigation"
></sz-how-rc-nav>
<div class="main">
    <div class="debug-box">
        <h3>debug</h3>
        <!--<button (click)="getStepGroupsForInterimEntities()">getStepGroupsForInterimEntities()</button>
        <button (click)="getDefaultStepGroups()">getDefaultStepGroups()</button>
        <button (click)="getDefaultResolutionStepGroups()">getDefaultResolutionStepGroups()</button>-->
        <button (click)="getStepNodesForInterimEntities()">getStepNodesForInterimEntities()</button> 
        <button (click)="getResolutionStepsAsNodesDebug()">getResolutionStepsAsNodes()</button> 
        <button (click)="getNestedStepGroup('V401992-S6')">getNestedStepGroup('V401992-S6')</button> 
        <button (click)="getStepNodes()">getStepNodes()</button> 

        
        <!--<button (click)="collapseAllSteps()">collpseAll()</button>
        <button (click)="getFinalEntityFromMemberByStepNumber(1)">getFinalEntityFromMember(#1)</button> 
        <button (click)="getFinalEntityFromMemberByStepNumber(2)">getFinalEntityFromMember(#2)</button> -->
    </div>
    <ul class="step-list tree">
        <li class="top-level">
            <sz-how-rc-final-entity-card *ngFor="let vCardData of finalCardsData"
                [data]="vCardData"
                [featureOrder]="orderedFeatures"
                [virtualEntitiesById]="virtualEntitiesById"></sz-how-rc-final-entity-card>
        </li>
        <li *ngFor="let item of stepsList; let rsInd=index"
            [class.hidden]="isParentEntityHidden(item)"
            [ngSwitch]="getListItemType(item)">
            <!--{{getListItemType(item)}}-->
            <ng-template [ngSwitchCase]="'STACK'">
                <sz-how-rc-step-stack
                    [data]="cooerceToStepGroup(item)"
                    [featureOrder]="orderedFeatures" 
                    [virtualEntitiesById]="virtualEntitiesById"></sz-how-rc-step-stack>
                <div class="stack-control" 
                    [class.expanded]="isGroupExpanded(cooerceToStepGroup(item))"
                    [class.collapsed]="!isGroupExpanded(cooerceToStepGroup(item))"
                    (click)="toggleGroupCollapsedState(cooerceToStepGroup(item))">
                    <!-- start collapsed  icon set -->
                    <mat-icon 
                    aria-hidden="false" 
                    class="hide-on-expanded"
                    fontIcon="arrow_upward"></mat-icon>
                    <div class="center-area hide-on-expanded">
                        <mat-icon 
                        aria-hidden="false" 
                        class="center-button"
                        fontIcon="add_circle"></mat-icon>
                    </div>
                    <mat-icon 
                    aria-hidden="false" 
                    class="hide-on-expanded"
                    fontIcon="arrow_downward"></mat-icon>
                    <!-- end   collapsed icon set -->
                    <!-- start expanded icon set  -->
                    <mat-icon 
                    aria-hidden="false" 
                    class="hide-on-collapsed arrow-down"
                    fontIcon="arrow_right"></mat-icon>
                    <div class="center-area hide-on-collapsed">
                        <mat-icon 
                        aria-hidden="false" 
                        class="center-button minus-button"
                        fontIcon="circle"><span>-</span></mat-icon>
                    </div>
                    <mat-icon 
                    aria-hidden="false" 
                    class="hide-on-collapsed arrow-up"
                    fontIcon="arrow_right"></mat-icon>
                    <!-- end   expanded icon set  -->
                </div>
            </ng-template>
            <ng-template [ngSwitchCase]="'GROUP'">
                <sz-how-rc-step-group
                    [data]="cooerceToStepGroup(item)"
                    [featureOrder]="orderedFeatures" 
                    [virtualEntitiesById]="virtualEntitiesById"></sz-how-rc-step-group>
            </ng-template>
            <ng-template [ngSwitchCase]="'STEP'">
                <sz-how-rc-step
                [attr.step-index]="rsInd"
                [attr.step-number]="cooerceToStep(item).stepNumber"
                [attr.virtual-id]="cooerceToStep(item).resolvedVirtualEntityId"
                [data]="cooerceToStep(item)" 
                [featureOrder]="orderedFeatures" 
                [virtualEntitiesById]="virtualEntitiesById"></sz-how-rc-step>
            </ng-template>
        </li>
        <!--<li *ngFor="let step of resolutionStepsWithGroupsOld; let rsInd=index"
            [ngSwitch]="isResolutionStep(step)">
            <ng-template [ngSwitchCase]="false">
                <sz-how-rc-step-group
                    [data]="cooerceToStepGroup(step)"
                    [featureOrder]="orderedFeatures" 
                    [virtualEntitiesById]="virtualEntitiesById"></sz-how-rc-step-group>
            </ng-template>
            <ng-template [ngSwitchCase]="true">
                <sz-how-rc-step *ngIf="isResolutionStep(step)"
                [attr.step-index]="rsInd"
                [attr.step-number]="cooerceToStep(step).stepNumber"
                [attr.virtual-id]="cooerceToStep(step).resolvedVirtualEntityId"
                [data]="cooerceToStep(step)" 
                [featureOrder]="orderedFeatures" 
                [virtualEntitiesById]="virtualEntitiesById"></sz-how-rc-step>
            </ng-template>
            <ng-template [ngSwitchCase]="false">
                <div class="stack-control" 
                    [class.expanded]="isGroupExpanded(cooerceToStepGroup(step))"
                    (click)="toggleCollapsedState(cooerceToStepGroup(step))">-->
                    <!-- start collapsed  icon set -->
                    <!--<mat-icon 
                    aria-hidden="false" 
                    class="hide-on-expanded"
                    fontIcon="arrow_upward"></mat-icon>
                    <div class="center-area hide-on-expanded">
                        <mat-icon 
                        aria-hidden="false" 
                        class="center-button"
                        fontIcon="add_circle"></mat-icon>
                    </div>
                    <mat-icon 
                    aria-hidden="false" 
                    class="hide-on-expanded"
                    fontIcon="arrow_downward"></mat-icon>-->
                    <!-- end   collapsed icon set -->
                    <!-- start expanded icon set  -->
                    <!--<mat-icon 
                    aria-hidden="false" 
                    class="hide-on-collapsed arrow-down"
                    fontIcon="arrow_right"></mat-icon>
                    <div class="center-area hide-on-collapsed">
                        <mat-icon 
                        aria-hidden="false" 
                        class="center-button minus-button"
                        fontIcon="circle"><span>-</span></mat-icon>
                    </div>
                    <mat-icon 
                    aria-hidden="false" 
                    class="hide-on-collapsed arrow-up"
                    fontIcon="arrow_right"></mat-icon>-->
                    <!-- end   expanded icon set  -->
                <!--</div>
            </ng-template>
        </li>-->
    </ul>
</div>